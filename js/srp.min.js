function addLoadEvent(r){var e=window.onload;window.onload="function"!=typeof window.onload?r:function(){e&&e(),r()}}function _fixed_tb_remove(){return jQuery("#TB_imageOff").unbind("click"),jQuery("#TB_closeWindowButton").unbind("click"),jQuery("#TB_window").fadeOut("fast",function(){jQuery("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload").unbind().remove()}),jQuery("#TB_window,#TB_overlay,#TB_HideSelect").one("unload",killTheDamnUnloadEvent),jQuery("#TB_load").remove(),"undefined"==typeof document.body.style.maxHeight&&(jQuery("body","html").css({height:"auto",width:"auto"}),jQuery("html").css("overflow","")),jQuery(document).unbind(".thickbox"),!1}function killTheDamnUnloadEvent(r){return r.stopPropagation(),r.stopImmediatePropagation(),!1}function _icon_array(r){var e={position:"",title:r,map:srp_map,icon:new google.maps.MarkerImage(_get_icon(r),new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(16,37))};return e}function _get_icon(r){var e={Schools:"schools.png","Grocery Stores":"grocery.png",Restaurants:"restaurants.png",Hospitals:"hospitals.png","Golf Cources":"golf.png",Banks:"banks.png","Gas Stations":"gas_stations.png"};return srp.srp_url+"/images/icons/"+e[r]}function srp_custom_icons(){var r=_icon_array("Schools","schools.png"),e=_icon_array("Grocery Stores","grocery.png"),a=_icon_array("Restaurants","restaurants.png"),n=_icon_array("Hospitals","hospitals.png"),s=_icon_array("Golf Cources","golf.png"),t=_icon_array("Banks","banks.png"),o=_icon_array("Gas Stations","gas_stations.png");custom_icons.schools=r,custom_icons.grocery=e,custom_icons.restaurants=a,custom_icons.hospitals=n,custom_icons.golf=s,custom_icons.banks=t,custom_icons.gas_stations=o}function srp_setDefaultMarker(r,e){var a=new google.maps.InfoWindow({content:e}),n=new google.maps.Marker({position:r,map:srp_map});n.setMap(srp_map),google.maps.event.addListener(n,"click",function(){a.open(srp_map,n,{maxWidth:315})})}function srp_createMarker(r,e,a){srp_custom_icons();var n=custom_icons[a];n.position=r;var s=new google.maps.Marker(n),t=new google.maps.InfoWindow({content:e});return google.maps.event.addListener(s,"click",function(){t.open(srp_map,s)}),s}function srp_createMarkerCustom(r,e,a,n,s,t){var o=new GMarker(r,custom_icons[n]),p=t+"<strong>"+e+"</a></strong> <br />"+a+'<br /><a href="'+s+'">listing info</a>',i=new google.maps.InfoWindow({content:p});return google.maps.event.addListener(o,"click",function(){i.open(srp_map,o)}),o}function srp_initialize(){myOptions={zoom:13,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.ROADMAP},srp_map=new google.maps.Map(document.getElementById("gre_map_canvas"),myOptions),srp_setupmap()}function srp_setupmap(){var r=new google.maps.LatLng(srp_listing_values.lat,srp_listing_values.lng);srp_map.setCenter(r,13),srp_setDefaultMarker(r,srp_listing_values.html)}function srp_addOverlay(r){"undefined"!=typeof gre_map?r.setMap(gre_map):"undefined"!=typeof srp_map&&r.setMap(srp_map)}function srp_removeOverlay(r){"undefined"!=typeof gre_map?r.setMap(null):"undefined"!=typeof srp_map&&r.setMap(null)}function srp_function_exists(r,e,a,n){return jQuery.post(srp.ajaxurl,{action:"srp_function_exists",name:r,type:e},function(r){"1"===r&&("undefined"!=typeof n?a(n):a())}),!1}function srp_requestYelp(r){var e=jQuery("#srp_gre_prop_coord").val(),a=e.split(","),n=jQuery(r).attr("name");if(jQuery(r).attr("checked")){if(markerArray.length>0){for(var s=!1,t=0;t<markerArray.length;t++)markerArray[t].cat==n&&(s=!0,srp_addOverlay(markerArray[t]),jQuery(".srp_gre_legend span."+n).remove());if(1==s){var o='<span class="'+n+'"><img src="'+_get_icon(custom_icons[n].title)+'" /> - '+custom_icons[n].title+"</span>";return jQuery("#map div.srp_gre_legend").append(o),!1}}var p=srp_ajax_loaderStart("gre_map_canvas",null);return jQuery.post(srp.ajaxurl,{action:"srp_getYelp_ajax",term:n,lat:a[0],lng:a[1]},function(r){srp_mapYelp(r),srp_ajax_loaderStop(p)},"json"),!1}for(var t=0;t<markerArray.length;t++)markerArray[t].cat==n&&(srp_removeOverlay(markerArray[t]),jQuery(".srp_gre_legend span."+n).remove());return!1}function srp_mapYelp(r){if(r.message){var e=srp_ajax_loaderStart("gre_map_canvas",r.message);return setTimeout(function(){srp_ajax_loaderStop(e)},2e3),!1}if("undefined"!=typeof r&&0!=r&&-1!=r){var a=r;for(var n in a){for(var s in a[n]){var t=a[n][s].lat,o=a[n][s].lng,p=a[n][s].html,i=new google.maps.LatLng(t,o),_=srp_createMarker(i,p,n);_.cat=n,markerArray.push(_),srp_addOverlay(_)}var l='<span class="'+n+'"><img src="'+_get_icon(custom_icons[n].title)+'" /> - '+custom_icons[n].title+"</span>";jQuery("#map div.srp_gre_legend").append(l)}}}function srp_requestSchools(){var r=jQuery("#srp_gre_prop_coord").val(),e=r.split(","),a=null,n="schools";if(jQuery("input#schools_select").attr("checked")){if(markerArray.length>0){for(var s=!1,t=0;t<markerArray.length;t++)markerArray[t].cat==n&&(s=!0,srp_addOverlay(markerArray[t]),jQuery(".srp_gre_legend span."+n).remove());if(1==s){var o='<span class="'+n+'"><img src="'+_get_icon(custom_icons[n].title)+'" /> - '+custom_icons[n].title+"</span>";return jQuery("#map div.srp_gre_legend").append(o),!1}}var p=srp_ajax_loaderStart("gre_map_canvas",null);return jQuery.post(srp.ajaxurl,{action:"srp_getSchools_ajax",address:a,lat:e[0],lng:e[1]},function(r){srp_mapSchools(r),srp_ajax_loaderStop(p)},"json"),!1}for(var t=0;t<markerArray.length;t++)markerArray[t].cat==n&&(srp_removeOverlay(markerArray[t]),jQuery(".srp_gre_legend span."+n).remove());return!1}function srp_mapSchools(r){if(r.message){var e=srp_ajax_loaderStart("gre_map_canvas",r.message);return setTimeout(function(){srp_ajax_loaderStop(e)},2e3),!1}var a=(jQuery("#srp_education").attr("id"),r.markers);for(var n in a){var s=a[n].lat,t=a[n].lng,o=a[n].html,p=new google.maps.LatLng(s,t),i=srp_createMarker(p,o,"schools");i.cat="schools",markerArray.push(i),i.setMap(srp_map)}var _='<span class="schools"><img src="'+_get_icon(custom_icons[i.cat].title)+'" /> - '+custom_icons[i.cat].title+"</span>";return jQuery("#map div.srp_gre_legend").append(_),!1}function srp_ajax_loaderStart(r,e){var a,n,s,t=Math.floor(100001*Math.random()),o="ajax_loading_"+r+"_"+t;null!=r&&"undefined"!=r?(n=jQuery("#"+r).width(),s=jQuery("#"+r).height(),a="#"+r):(a="body",n=jQuery(window).width(),s=jQuery(window).height());var p='<img src="'+srp.srp_url+'/images/ajax-loader.gif" alt="Loading. Please wait.">';(null==e||"undefined"==e)&&(e="Loading...");var i='<div id="'+o+'" class="ajax_loader">'+p+e+"</div>";jQuery(a).prepend(i);var _=jQuery("#"+o).width(),l=jQuery("#"+o).height(),u=n/2-_/2,c=s/2-l/2;return jQuery("#"+o).css({top:c,left:u}),o}function srp_ajax_loaderStop(r){jQuery("#"+r).remove()}function srp_profile(r){if(10==r)return!1;if(!r)var r=0;for(var e=load_srp_functions.length,a=srp_ajax_loaderStart("srp_extension",null),n=0;e>n;n++){var s=JSON.stringify(srp_listing_values),t=load_srp_functions[n];return jQuery.ajax({type:"POST",url:srp.ajaxurl,data:{action:"srp_ajax_call",callback:t,srp_listing_values:s},success:function(e){srp_output_gre(e),srp_ajax_loaderStop(a),r++,load_srp_functions.splice("",1),load_srp_functions.length>0&&srp_profile(r)},async:!0,dataType:"text"}),!1}return!1}function srp_profile_tabs(r){if(10==r)return!1;if(!r)var r=0;for(var e=load_srp_functions.length,a=srp_ajax_loaderStart("srp_extension",null),n=0;e>n;n++){var s=JSON.stringify(srp_listing_values),t=load_srp_functions[n];jQuery.ajax({type:"POST",url:srp.ajaxurl,data:{action:"srp_ajax_call",callback:t,srp_listing_values:s},success:function(r){srp_output_gre(r),srp_ajax_loaderStop(a)},async:!0,dataType:"text"})}return!1}function srp_output_gre(r){jQuery("#srp_extension").append(r),srp_check_prefilled(),jQuery("#srp-tab-wrap").data("ui-tabs")&&jQuery("#srp-tab-wrap").tabs("destroy"),srp_refresh_tabs("#srp-tab-wrap"),srp_refresh_tabs(".srp-tabs")}function srp_refresh_tabs(r){jQuery(r).length&&jQuery.fn.tabs&&jQuery(r).tabs()}var srp_map,custom_icons=[],myOptions=[],markerArray;markerArray=new Array,jQuery(document).ready(function(){window.tb_remove=function(){_fixed_tb_remove()},srp_refresh_tabs("#srp-tab-wrap"),srp_refresh_tabs(".srp-tabs"),jQuery.browser.msie&&(jQuery('input[id^="yelp_cat_"]').click(function(){this.blur(),this.focus()}),jQuery("input#schools_select").click(function(){this.blur(),this.focus()})),jQuery('input[id^="yelp_cat_"]').change(function(){srp_requestYelp(this)}),jQuery("input#schools_select").change(function(){srp_requestSchools()}),"undefined"!=typeof srp_listing_values&&srp_initialize(),"undefined"!=typeof srp_profile_view&&window[srp_profile_view]()});